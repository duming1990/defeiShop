$(function() {
    var j = $("header.index").height();
    var g = $('a.anchor[name="0"]').offset().top;
    var a = $(".city-side-nav");
    var i = a.height();
    var d = navigator.userAgent.toLowerCase().indexOf("mac os") > 0;
    var b = null;
    function f(m) {
        if (m === false) {
            return false;
        }
        var l = $('a.anchor[name="' + m + '"]');
        while (l.length == 0 && m <= "Z") {
            m = String.fromCharCode(m.charCodeAt(0) + 1);
            l = $('a.anchor[name="' + m + '"]');
        }
        var k = l.offset().top - g;
        $("html,body").scrollTop(k);
    }
    function e(p) {
        var k = p.y2 || p.y1;
        var o = i / 30;
        var n = k - j - o / 4;
        if (k - j < 0) {
            return false;
        }
        var l = Math.floor(Math.round(Math.max(n, 0)) / o);
        var m = 0;
        if (l < 3) {
            m = l < 2 ? l :"A";
        } else {
            m = String.fromCharCode(62 + l);
            if (m > "Z") {
                m = "Z";
            }
        }
        return m;
    }
    a.bind("tapStart tapMove", function(k, m) {
        k.parentEvent.preventDefault();
        var l = e(m);
        b = l;
        f(l);
    }).bind("tapCancel", function(k, l) {
        if (k.parentEvent.type == "scroll") {
            return false;
        }
    }).bind("contextmenu selectstart dragstart", function() {
        return false;
    });
//    $(".city-view a").click(function() {
//        if (b !== null) {
//            _gaq.push([ "_trackEvent", "City-选择", "click", "cityDot-" + b ]);
//        }
//        _gaq.push([ "_trackEvent", "City-选择", "click", $.trim($(this).text()) ]);
//    });
    var h = null;
    if (d) {
        h = setTimeout(function() {
            var k = $("#city_overlay").height();
            c(k);
            h = setTimeout(arguments.callee, 20);
        }, 20);
    }
    $(window).bind("resize", function() {
        var k = d ? window.innerHeight || $(window).height() :$(window).height();
        c(k);
    }).trigger("resize");
    function c(l) {
        var k = l - j;
        if (k != i) {
            i = k;
            a.children("img").height(k);
        }
    }
});